<!doctype html>
<html lang="en" >
<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8"/>
    <link rel="stylesheet" href="dist/oldist/openlayers/ol.css" type="text/css">
    <style>
        html,body{
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            clear: both;
            position: relative;
            height: 100%;
            width: 100%;
            /*border: 1px solid rgb(78, 78, 78);*/
        }
        #loaction{
            float:right;
        }

    </style>
    <script type="text/javascript" src="dist/oldist/openlayers/ol.js"></script>
    <script type="text/javascript" src="dist/jquery1.6.4/jquery.js"></script>
    <!--
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.6.4/jquery.js"></script>
    -->

    <title>xjs olmap</title>
</head>
<body>

    <div id="map" class="map" ></div>
    <div id="wrapper">
        <div id="location"></div>
    </div>
    <script type="text/javascript">
        //基本底图
        var envstr = '';
        var extent = [73.44696044921875,6.318641185760498,135.08583068847656,53.557926177978516];

        var urlAdr = 'http://47.94.150.127:8080/geoserver/xjs/wms';
        //var layerName = 'xjs:BoundaryChn2_4p,xjs:BoundaryChn2_4l,xjs:BoundaryChn1_4l';
        var layerName = 'xjs:BoundaryChn2_4p,xjs:BoundaryChn2_4l,xjs:BoundaryChn1_4l';
        var tiled;   //Tile WMS
        var untiled;   //WMS服务
        var provinceAnotation; //省注记
        var map; //地图
        var init = function(){
            //设置地图范围

            var mlayers = initLayers();
            //定义地图对象//地图对象
            map = new ol.Map({

                layers: mlayers,
                target: 'map',
                view: new ol.View({
                    projection: 'EPSG:4326',
                    //center: [115, 39],
                    //zoom: 4
                }),
                controls: ol.control.defaults({
                    attributionOptions: {
                        collapsible: true
                    }
                })

            });
            initOlTools(); //初始化工具

        }

        //初始化所有图层，返回图层数组
        var initLayers = function (){
            //OSM图像图层
            osmtile =  new ol.layer.Tile({
                visible:true,
                source: new ol.source.OSM({
                    maxZoom:4
                })
            });
            //瓦片图层
            tiled = new ol.layer.Tile({
                visible:true,
                source: new ol.source.TileWMS({
                    url: urlAdr,  //URL

                    params: {  //请求参数
                        'LAYERS': layerName,
                        'TILED': false,  //对TileWMS无影响
                        'env':'',   //ogc:function env动态设置地图颜色，空字符表示默认采用SLD文件配置的值
                    },
                    serverType: 'geoserver'
                })
            });

            //注记图层
            provinceAnotation = new ol.layer.Image({
                visible:true,
                source: new ol.source.ImageWMS({
                    ratio: 1,
                    url: urlAdr,
                    params: {
                        "LAYERS": 'xjs:ProvinceAnotation',
                        'TILED': false,
                    },
                    serverType: 'geoserver'
                })
            });

            //JSON图层
            var jsonUrl = "data/GeoJSON_HB.json"    //   "data/GeoJSON_HB.json";
            //Json读取
            var jsonVecLayer = new ol.layer.Vector({
                title: 'add Layer',
                source: new ol.source.Vector({
                    projection: 'EPSG:4326',
                    url: jsonUrl, //GeoJSON的文件路径
                    format: new ol.format.GeoJSON()
                })
            })
            var mlayers = [osmtile,tiled,jsonVecLayer,provinceAnotation];  //图层数组
            return mlayers;
        }

        var initOlTools = function(){
            //自适应地图view
            map.getView().fit(extent, map.getSize());
            //map.getView().setZoom(4);
            //添加比例尺控件
            map.addControl(new ol.control.ScaleLine());
            //添加缩放滑动控件
            map.addControl(new ol.control.ZoomSlider());
            //添加全屏控件
            map.addControl(new ol.control.FullScreen());
            //添加鼠标定位控件
            map.addControl(new ol.control.MousePosition({
                    undefinedHTML: 'outside',
                    projection: 'EPSG:4326',
                    target:$("#location")[0],
                    coordinateFormat: function(coordinate) {
                        return ol.coordinate.format(coordinate, '{x}, {y}', 4);
                    }
                })
            );
        }

        $.ajax({
            url : "/getGeoJson", //后台查询验证的方法
            dataTpye : "json",
            data : {

            },
            type : "post",
            success : function(msg) {
                var parsedJson = jQuery.parseJSON(msg);
                console.log(parsedJson);
            },
            error:function(){  //请求失败的回调方法
                alert("请求失败，请重试");
            }
        });



        //函数入口
        $(function () {
            init();
        })

    </script>
</body>
</html>

