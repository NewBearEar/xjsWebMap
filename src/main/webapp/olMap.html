<!doctype html>
<html lang="en" >
<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8"/>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8"/>
    <meta name="renderer" content="webkit|blink"/>
    <meta name="force-rendering" content="webkit|blink"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>

    <script type="text/javascript" src="dist/oldist/openlayers/ol.js"></script>
    <script type="text/javascript" src="dist/jquery/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="dist/jquery-ui-1.12.1/jquery-ui.js"></script>

    <!--js放在css文件前，防止css样式被js刷掉-->
    <!--链接式导入css-->
    <link rel="stylesheet" href="dist/oldist/openlayers/ol.css" type="text/css">
    <link rel="stylesheet" href="dist/jquery-ui-1.12.1/jquery-ui.css" type="text/css">

    <link rel="stylesheet" href="css/myMapStyle.css" type="text/css">
    <link rel="stylesheet" href="css/mySearchStyle.css">
    <link rel="stylesheet" href="css/loginStyle.css">
    <style>
        /*基于juery ui css
        /*自动补全loading*/
        .ui-autocomplete-loading {
            background: white url('dist/jquery-ui-1.12.1/images/ui-anim_basic_16x16.gif') right center no-repeat;
        }
        .ui-autocomplete{
            width: 250px;
            left: 50px;
            padding: 0;
            /*试试阴影效果*/
            filter: progid:DXImageTransform.Microsoft.shadow(color=#909090,direction=120,strength=2);
            -moz-box-shadow: 1px 1px 3px #909090;
            -webkit-box-shadow: 1px 1px 3px #909090;
            box-shadow: 1px 1px 3px #909090;
            border-color: rgb(200,200,200);
        }
        /*重写选中时的样式*/
        .ui-state-active:hover {
            border: 1px solid rgb(200,200,200);
            background: rgb(238,238,238);
            font-weight: normal;
            color: #000000;  /*字体颜色黑色不变*/

        }


    </style>

    <!--
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.6.4/jquery.js"></script>
    -->

    <title>xjs olmap</title>
</head>
<body >
    <div id="loadgif" style="position:absolute;top:45%;left:45%;z-index: 1001">
        　　<img alt="加载中..." src="img/loading2.gif"/>
    </div>
    <div id="left-panel" class style="display: block;">
        <div id = searchBar style="pointer-events: auto">
            <form id="formSearch" action="" onsubmit="return false;" >   <!--οnsubmit="return false;"阻止提交,注意写的时候引号里面不能是绿色字符串，必须变色才能识别到里面的js代码-->   <!--action="getGeoJson"     action="/xjs/getGeoJson"   不需要action-->
                <img src="img/searchimg.png" alt="">
                <input type="text" id="searchTxt" name="searchTxt" placeholder="输入搜索城市名" onkeydown="if(event.keyCode==13) {$('#btn').click(); $('#searchTxt').autocomplete('close'); }" > <!--回车调用搜索按钮的click事件并关闭autocomplete-->
                    <!--onblur="if(this.value == '') this.value='在此输入您要查找的内容，点击搜索';"-->
                <input type="button" id="btn" value="搜索"></input>
            </form>
        </div>
        <ul id="cards-level0" class="cardlist"></ul>
        <ul id="cards-level1" class="cardlist"></ul>
        <ul id="cards-level2" class="cardlist"></ul>
    </div>

    <div id="app-right-top">
        <div id="user-center" class="ui3-user-center-wrap">
            <div class="avatar-abstract" style="background-image: url('https://himg.bdimg.com/sys/portrait/item/16f6e585a55fe9ad94e98193b930.jpg');"></div>
        </div>
        <div id="message-center" class="message-center-hidden">
            <div class="message-center-entrance"></div>
            <div id="message-panel">
                <p class="welcom-message">欢迎登录 <a href="#" id="welcom-nickname">wdnmd</a></p>
            </div>
        </div>
    </div>

    <div class="htmleaf-container tenant-model-box">
        <div id="login-wrapper" class="log-page " >
            <header class="tenant-model-header">
                <h4 style="margin-left: 20px;padding:5px;font-weight: bold;height: 25px;line-height: 30px;font-size: 15px;color: #b3b3b3;">Login Or Register</h4>
                <span class="closeModel">×</span>
            </header>
            <div id="login_form" class="form">
                <form class="register-form">
                    <input type="text" placeholder="用户名" id="r_user_name" name="register_username" class="text-input"/>
                    <input type="password" placeholder="密码" id="r_password" name="register_username" class="text-input"/>
                    <input type="text" placeholder="电子邮件" id="r_email" name="register_email" class="text-input"/>
                    <button id="create">创建账户</button>
                    <p class="message">已经有了一个账户? <a href="#">立刻登录</a></p>
                </form>
                <form class="login-form">
                    <input type="text" placeholder="用户名" id="user_name" name="login_username" class="text-input"/>
                    <input type="password" placeholder="密码" id="password" name="login_password" class="text-input"/>
                    <input type="checkbox" name="remember" value="1"/> 记住我
                    <button id="login">登　录</button>
                    <p class="message">还没有账户?
                        <a href="#">立刻创建</a>
                    </p>
                </form>
            </div>
        </div>
        <div id="logout-wrapper" class="log-page login-logout-page-hidden" >
            <header class="tenant-model-header">
                <h4 style="margin-left: 20px;padding:5px;font-weight: bold;height: 25px;line-height: 30px;font-size: 15px;color: #b3b3b3;">Logout</h4>
                <span class="closeModel">×</span>
            </header>
            <div id="logout_form" class="form">
                <form class="logout-form">
                    <button id="logout">登　出</button>
                </form>
            </div>
        </div>

    </div>

    <div id="map" class="map" ></div>
    <div id="wrapper-loc"></div>
    <script type="text/javascript" src="js/search.js"></script>
    <script type="text/javascript" src="js/initMap.js"></script>
    <script type="text/javascript" src="js/loginRegisterEvent.js"></script>
    <script type="text/javascript">
        //window.onload = checkIfLogined;
        //判断是否登录的flag，但是否可以用cookie来实现？
        var isLogined = false;
        //函数入口
        $(function () {
            $("#loadgif").hide();  //隐藏loading动画
            initMap();
            loginRegisterAddEvents();
            checkIfLogined();
        })

        function checkIfLogined() {
            //检查login servlet session是否保存有相关登录信息
            $.ajax({
                url:'login',
                dataType:"json",
                type:"post",
                success: function (userProfile) {  //回调函数，更新map
                    console.log(userProfile);
                    if(userProfile.statusCode == 1) {
                        //alert("登录成功！");
                        isLogined = true;
                        switchLoginoutWrapper(isLogined)
                        showLoginedInfo();
                    }
                },
                error: function () {  //请求失败的回调方法
                    $("#loadgif").hide();
                    alert("请求失败，请重试");
                }
            })
        }





    </script>
</body>
</html>

